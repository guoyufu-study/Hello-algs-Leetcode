## 面试题64. 求1+2+…+n

### 问题描述

求 1+2+...+n ，要求不能使用乘除法、for、while、if、else、switch、case等关键字及条件判断语句（A?B:C）。

 

示例 1：

```
输入: n = 3
输出: 6
```

示例 2：

```
输入: n = 9
输出: 45
```
 

限制：

```
    1 <= n <= 10000
```

来源：力扣（LeetCode）
链接：https://leetcode-cn.com/problems/qiu-12n-lcof
著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。

### 模板代码

``` java
class Solution {
    public int sumNums(int n) {

    }
}
```

### 解决方案

本题在简单问题上做了许多限制，需要使用排除法一步步导向答案。
`1+2+...+(n−1)+n1+2+...+(n-1)+n1+2+...+(n−1)+n` 的计算方法主要有三种：平均计算、迭代、递归。

方法一： 平均计算
问题： 此计算必须使用 乘除法 ，因此本方法不可取，直接排除。

``` java
public int sumNums(int n) {
    return (1 + n) * n / 2;
}
```

方法二： 迭代
问题： 循环必须使用 `while` 或 `for`，因此本方法不可取，直接排除。

``` java
public int sumNums(int n) {
    int res = 0;
    for(int i = 1; i <= n; i++)
        res += i;
    return res;
}
```

方法三： 递归
问题： 终止条件需要使用 `if`，因此本方法不可取。
思考： 除了 `if` 和 `switch` 等判断语句外，是否有其他方法可用来终止递归？

``` java
public int sumNums(int n) {
    if(n == 1) return 1;
    n += sumNums(n - 1);
    return n;
}
```


#### 1. 短路运算+递归

使用递归，使用 && 短路来终止递归。

条件与 && 具有短路原则，即在第一个条件语句为 false 的情况下不会去执行第二个条件语句。利用这一特性，将递归的返回条件取非然后作为 && 的第一个条件语句，递归的主体转换为第二个条件语句，那么当递归的返回条件为 true 的情况下就不会执行递归的主体部分，递归返回。

[代码实现](q0064/solu2/Solution.java)

#### 2. 位运算实现乘法

负数在参与位运算时使用的是补码
-1的原码是   10000000 00000000 00000000 00000001
-1的反码是   11111111 11111111 11111111 11111110
-1的补码是   11111111 11111111 11111111 11111111
因此任何数与-1做 与运算 的结果任然为原数

由等差数列求和公式可知，结果等于`n*(n+1)/2`，其中**除以2可以通过右移1位进行操作**
但`n*(n+1)`在不允许使用**乘法**的情况下，只能把n或n+1其中一个拆解为2的n次幂数之和，配合另一个来进行位运算和累加此代码利用了-1和任何整数进行与运算还等于原数的特点
`-(n + 1 >> 0 & 1)`用于求从低到高第i+1位如果为0取0，如果为1取-1


[代码实现](q0064/solu3/Solution.java)


